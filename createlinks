#!/usr/bin/perl -w

use esmith::Build::CreateLinks qw(:all);

# #--------------------------------------------------
# # actions for console-save event
# #--------------------------------------------------
# my $event = "console-save";

# templates2events("/etc/httpd/conf/httpd.conf", $event);
# templates2events("/etc/httpd/conf.d/ssl.conf", $event);
# safe_symlink("restart", "root/etc/e-smith/events/$event/services2adjust/httpd");

# #--------------------------------------------------
# # actions for bootstrap-console-save event
# #--------------------------------------------------
# $event = "bootstrap-console-save";

# templates2events("/etc/httpd/conf/httpd.conf", $event);
# templates2events("/etc/httpd/conf.d/ssl.conf", $event);

# #--------------------------------------------------
# # actions for domain-create event
# #--------------------------------------------------

# $event = "domain-create";

# templates2events("/etc/httpd/conf/httpd.conf", $event);
# templates2events("/etc/httpd/conf.d/ssl.conf", $event);
# safe_symlink("reload", "root/etc/e-smith/events/$event/services2adjust/httpd");

# #--------------------------------------------------
# # actions for domain-delete event
# #--------------------------------------------------

# $event = "domain-delete";

# templates2events("/etc/httpd/conf/httpd.conf", $event);
# templates2events("/etc/httpd/conf.d/ssl.conf", $event);
# safe_symlink("reload", "root/etc/e-smith/events/$event/services2adjust/httpd");

# #--------------------------------------------------
# # actions for domain-modify event
# #--------------------------------------------------

# $event = "domain-modify";

# templates2events("/etc/httpd/conf/httpd.conf", $event);
# templates2events("/etc/httpd/conf.d/ssl.conf", $event);
# safe_symlink("reload", "root/etc/e-smith/events/$event/services2adjust/httpd");

# #--------------------------------------------------
# # actions for host-create event
# #--------------------------------------------------

# $event = "host-create";

# templates2events("/etc/httpd/conf/httpd.conf", $event);
# safe_symlink("reload", "root/etc/e-smith/events/$event/services2adjust/httpd");

# #--------------------------------------------------
# # actions for host-delete event
# #--------------------------------------------------

# $event = "host-delete";

# templates2events("/etc/httpd/conf/httpd.conf", $event);
# safe_symlink("reload", "root/etc/e-smith/events/$event/services2adjust/httpd");

# #--------------------------------------------------
# # actions for host-modify event
# #--------------------------------------------------

# $event = "host-modify";

# templates2events("/etc/httpd/conf/httpd.conf", $event);
# safe_symlink("reload", "root/etc/e-smith/events/$event/services2adjust/httpd");

#--------------------------------------------------
# actions for ibay-create event
#--------------------------------------------------

$event = "ibay-create";

templates2events("/etc/httpd/conf/httpd.conf", $event);
safe_symlink("reload", "root/etc/e-smith/events/$event/services2adjust/httpd");

#--------------------------------------------------
# actions for ibay-delete event
#--------------------------------------------------

$event = "ibay-delete";

templates2events("/etc/httpd/conf/httpd.conf", $event);
safe_symlink("reload", "root/etc/e-smith/events/$event/services2adjust/httpd");

#--------------------------------------------------
# actions for ibay-modify event
# (used after changing parameters for a single i-bay)
#--------------------------------------------------

$event = "ibay-modify";

templates2events("/etc/httpd/conf/httpd.conf", $event);
safe_symlink("reload", "root/etc/e-smith/events/$event/services2adjust/httpd");


#--------------------------------------------------
# actions for network-create event
#--------------------------------------------------

$event = "network-create";

templates2events("/etc/httpd/conf/httpd.conf", $event);
safe_symlink("reload", "root/etc/e-smith/events/$event/services2adjust/httpd");

#--------------------------------------------------
# actions for network-delete event
#--------------------------------------------------

$event = "network-delete";

templates2events("/etc/httpd/conf/httpd.conf", $event);
safe_symlink("reload", "root/etc/e-smith/events/$event/services2adjust/httpd");

#--------------------------------------------------
# actions for remoteaccess-update event
#--------------------------------------------------

$event = "remoteaccess-update";

templates2events("/etc/httpd/conf/httpd.conf", $event);
safe_symlink("reload", "root/etc/e-smith/events/$event/services2adjust/httpd");

#--------------------------------------------------
# actions for email-update event
#--------------------------------------------------

$event = "email-update";

templates2events("/etc/httpd/conf/httpd.conf", $event);
safe_symlink("reload", "root/etc/e-smith/events/$event/services2adjust/httpd");

#--------------------------------------------------
# actions for logrotate event
#--------------------------------------------------

$event = "logrotate";

safe_symlink("reload", "root/etc/e-smith/events/$event/services2adjust/httpd");

# Set up generic logfile timestamp renaming/symlinking

foreach (qw(
    /var/log/httpd/error_log
    /var/log/httpd/access_log
    ))
{
    safe_touch "root/etc/e-smith/events/logrotate/logfiles2timestamp/$_";
    safe_touch "root/etc/e-smith/events/post-install/logfiles2timestamp/$_";
    safe_touch "root/etc/e-smith/events/post-upgrade/logfiles2timestamp/$_";
}


#--------------------------------------------------
# actions for nethserver-httpd event
#--------------------------------------------------

$event = "nethserver-httpd-update";

event_templates($event, 
		"/etc/httpd/conf/httpd.conf",
		"/etc/httpd/conf.d/ssl.conf");

safe_symlink("restart", "root/etc/e-smith/events/$event/services2adjust/httpd");
